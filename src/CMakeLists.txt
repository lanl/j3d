# (c) 2025. Triad National Security, LLC. All rights reserved.
# This program was produced under U.S. Government contract 89233218CNA000001
# for Los Alamos National Laboratory (LANL), which is operated by Triad National
# Security, LLC for the U.S. Department of Energy/National Nuclear Security
# Administration. All rights in the program are reserved by Triad National Security,
# LLC, and the U.S. Department of Energy/National Nuclear Security Administration.
# The Government is granted for itself and others acting on its behalf a nonexclusive,
# paid-up, irrevocable worldwide license in this material to reproduce, prepare.
# derivative works, distribute copies to the public, perform publicly and display
# publicly, and to permit others to do so.

set(j3d_SOURCES
    j3d.cc
    j2d.cc
    )

target_sources(j3d PRIVATE ${j3d_SOURCES})

# What headers should it use and install

set(j3d_HEADERS
    j3d.h
    j2d.h
    )

list(TRANSFORM j3d_HEADERS PREPEND "${CMAKE_CURRENT_SOURCE_DIR}/")

set_target_properties(j3d PROPERTIES
  PUBLIC_HEADER "${j3d_HEADERS}")

# In addition to the include directories of the source, we need to
# include the build or directory to get the autogenerated j3d-config.h
# (The first of these is needed if J3D is included as a submodule, the
# second is needed for the auto-generated config file if J3D is
# included as a submodule, the third is to get the autogenerated
# config header if J3D is being compiled separately (not sure this has
# been input correctly or in the best manner) and the last is for
# dependencies in installations)

target_include_directories(j3d PUBLIC
  $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
  $<BUILD_INTERFACE:${j3d_BINARY_DIR}>
  $<BUILD_INTERFACE:${CMAKE_BINARY_DIR}>
  $<INSTALL_INTERFACE:include>)

set(ENABLE_UNIT_TESTS False CACHE BOOL "build and run tests")

if (ENABLE_UNIT_TESTS)

  # j2d unit tests
  add_executable(j2d_unit_tests tests/j2d_unit_tests.cc tests/test_helpers.cc)
  target_link_libraries(j2d_unit_tests PRIVATE j3d m)
  add_test(NAME j2d_unit_tests
    COMMAND j2d_unit_tests
    WORKING_DIRECTORY ${PROJECT_BINARY_DIR})

  # j3d unit tests
  add_executable(j3d_unit_tests tests/j3d_unit_tests.cc tests/test_helpers.cc)
  target_link_libraries(j3d_unit_tests PRIVATE j3d m)
  add_test(NAME j3d_unit_tests
    COMMAND j3d_unit_tests
    WORKING_DIRECTORY ${PROJECT_BINARY_DIR})

endif ()


